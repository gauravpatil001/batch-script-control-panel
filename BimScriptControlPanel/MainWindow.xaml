<Window x:Class="BimScriptControlPanel.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="BIM Script Control Panel"
        Height="760"
        Width="1220"
        MinHeight="640"
        MinWidth="1000"
        Background="#F6F8FB">
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="360" MinWidth="280"/>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*" MinWidth="460"/>
        </Grid.ColumnDefinitions>

        <TextBlock Grid.Row="0"
                   Grid.Column="0"
                   Grid.ColumnSpan="3"
                   Text="BIM Script Manager"
                   FontSize="30"
                   FontWeight="SemiBold"
                   Foreground="#0F172A"
                   Margin="0,0,0,4"/>
        <TextBlock Grid.Row="1"
                   Grid.Column="0"
                   Grid.ColumnSpan="3"
                   Text="Script catalog and DAG workflow execution"
                   FontSize="14"
                   Foreground="#475569"
                   Margin="0,0,0,12"/>

        <Border Grid.Row="2"
                Grid.Column="0"
                Background="White"
                BorderBrush="#DFE5EE"
                BorderThickness="1"
                CornerRadius="10"
                Padding="12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <TextBlock Text="Scripts"
                           FontSize="18"
                           FontWeight="SemiBold"
                           Foreground="#0F172A"/>

                <Grid Grid.Row="1" Margin="0,10,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Button Name="AddScriptButton"
                            Grid.Column="0"
                            Content="Add"
                            Click="AddScriptButton_Click"
                            Padding="10,7"
                            BorderThickness="0"
                            Background="#0F172A"
                            Foreground="White"/>
                    <Button Name="RemoveScriptButton"
                            Grid.Column="2"
                            Content="Remove"
                            Click="RemoveScriptButton_Click"
                            Padding="10,7"
                            BorderBrush="#CBD5E1"
                            BorderThickness="1"
                            Background="#EEF2F7"
                            Foreground="#0F172A"
                            IsEnabled="False"/>
                </Grid>

                <ListView Name="ScriptListView"
                          Grid.Row="2"
                          SelectionChanged="ScriptListView_SelectionChanged"
                          SelectionMode="Single"
                          BorderBrush="#E2E8F0"
                          BorderThickness="1"
                          Background="#FBFDFF">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Width="115" DisplayMemberBinding="{Binding Name}">
                                <GridViewColumn.Header>
                                    <GridViewColumnHeader Content="Name"
                                                          Tag="Name"
                                                          Click="ScriptColumnHeader_Click"/>
                                </GridViewColumn.Header>
                            </GridViewColumn>
                            <GridViewColumn Width="130" DisplayMemberBinding="{Binding DateModified, StringFormat={}{0:yyyy-MM-dd HH:mm}, TargetNullValue=-}">
                                <GridViewColumn.Header>
                                    <GridViewColumnHeader Content="Date Modified"
                                                          Tag="DateModified"
                                                          Click="ScriptColumnHeader_Click"/>
                                </GridViewColumn.Header>
                            </GridViewColumn>
                            <GridViewColumn Width="360" DisplayMemberBinding="{Binding Path}">
                                <GridViewColumn.Header>
                                    <GridViewColumnHeader Content="Path"
                                                          Tag="Path"
                                                          Click="ScriptColumnHeader_Click"/>
                                </GridViewColumn.Header>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </Grid>
        </Border>

        <GridSplitter Grid.Row="2"
                      Grid.Column="1"
                      Width="6"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Stretch"
                      ResizeDirection="Columns"
                      ResizeBehavior="PreviousAndNext"
                      ShowsPreview="True"
                      Background="#D1D9E6"/>

        <Border Grid.Row="2"
                Grid.Column="2"
                Background="White"
                BorderBrush="#DFE5EE"
                BorderThickness="1"
                CornerRadius="10"
                Padding="14">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="6"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Name="SelectedScriptText"
                           Text="Selected: None"
                           FontSize="15"
                           FontWeight="SemiBold"
                           Foreground="#0F172A"/>

                <Grid Grid.Row="1" Margin="0,8,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="8"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox Name="SelectedPathTextBox"
                             Grid.Column="0"
                             IsReadOnly="True"
                             Padding="8,7"
                             BorderBrush="#CBD5E1"
                             BorderThickness="1"
                             Background="#FFFFFF"
                             Foreground="#334155"/>
                    <Button Name="ChangePathButton"
                            Grid.Column="2"
                            Content="Change"
                            Click="ChangePathButton_Click"
                            Padding="12,7"
                            BorderBrush="#CBD5E1"
                            BorderThickness="1"
                            Background="#EEF2F7"
                            Foreground="#0F172A"
                            IsEnabled="False"/>
                </Grid>

                <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Name="RunButton"
                            Content="Run Script"
                            Click="RunButton_Click"
                            Padding="14,8"
                            BorderThickness="0"
                            Background="#16A34A"
                            Foreground="White"
                            IsEnabled="False"
                            Margin="0,0,8,0"/>
                    <Button Name="StopButton"
                            Content="Stop"
                            Click="StopButton_Click"
                            Padding="14,8"
                            BorderThickness="0"
                            Background="#DC2626"
                            Foreground="White"
                            IsEnabled="False"
                            Margin="0,0,8,0"/>
                    <Button Name="ClearLogButton"
                            Content="Clear Log"
                            Click="ClearLogButton_Click"
                            Padding="14,8"
                            BorderBrush="#CBD5E1"
                            BorderThickness="1"
                            Background="#EEF2F7"
                            Foreground="#0F172A"/>
                </StackPanel>

                <Border Grid.Row="3"
                        BorderBrush="#E2E8F0"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        Margin="0,0,0,10"
                        Background="#FBFDFF">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <TextBlock Text="Workflow Graph"
                                   FontSize="14"
                                   FontWeight="SemiBold"
                                   Foreground="#0F172A"/>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,8,0,8">
                            <Button Name="NodeBuilderButton"
                                    Content="Node Builder"
                                    Click="NodeBuilderButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderThickness="0"
                                    Background="#0F172A"
                                    Foreground="White"
                                    Margin="0,0,8,0"/>
                            <Button Name="RunWorkflowButton"
                                    Content="Run Workflow"
                                    Click="RunWorkflowButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderThickness="0"
                                    Background="#2563EB"
                                    Foreground="White"
                                    Margin="0,0,8,0"/>
                            <Button Name="ClearWorkflowButton"
                                    Content="Clear"
                                    Click="ClearWorkflowButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderBrush="#CBD5E1"
                                    BorderThickness="1"
                                    Background="#EEF2F7"
                                    Foreground="#0F172A"
                                    Margin="0,0,12,0"/>

                            <TextBlock Text="Max parallel:"
                                       VerticalAlignment="Center"
                                       Foreground="#334155"
                                       Margin="0,0,6,0"/>
                            <ComboBox Name="MaxParallelComboBox"
                                      Width="72"
                                      Height="32"
                                      SelectedValuePath="Tag"
                                      SelectedValue="2"
                                      SelectionChanged="MaxParallelComboBox_SelectionChanged"
                                      VerticalContentAlignment="Center"
                                      VerticalAlignment="Center"
                                      Margin="0,0,12,0">
                                <ComboBoxItem Content="1" Tag="1"/>
                                <ComboBoxItem Content="2" Tag="2"/>
                                <ComboBoxItem Content="4" Tag="4"/>
                                <ComboBoxItem Content="8" Tag="8"/>
                            </ComboBox>

                            <CheckBox Name="StopOnFirstFailureCheckBox"
                                      Content="Stop on first failure"
                                      IsChecked="True"
                                      Checked="StopOnFirstFailureCheckBox_Changed"
                                      Unchecked="StopOnFirstFailureCheckBox_Changed"
                                      Foreground="#334155"
                                      Height="32"
                                      Padding="0"
                                      Margin="0,1,0,0"
                                      VerticalContentAlignment="Center"
                                      VerticalAlignment="Center"/>
                        </StackPanel>

                        <Grid Grid.Row="2" Margin="0,0,0,8" VerticalAlignment="Center">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="240"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="8"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Preset:"
                                       VerticalAlignment="Center"
                                       Foreground="#334155"/>
                            <ComboBox Name="WorkflowPresetComboBox"
                                      Grid.Column="2"
                                      Height="32"
                                      Padding="6,0,6,0"
                                      DisplayMemberPath="Name"
                                      SelectionChanged="WorkflowPresetComboBox_SelectionChanged"
                                      VerticalAlignment="Center"
                                      VerticalContentAlignment="Center"/>
                            <Button Name="SavePresetButton"
                                    Grid.Column="4"
                                    Content="Save Preset"
                                    Click="SavePresetButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderThickness="0"
                                    Background="#0F172A"
                                    Foreground="White"/>
                            <Button Name="LoadPresetButton"
                                    Grid.Column="6"
                                    Content="Load"
                                    Click="LoadPresetButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderThickness="0"
                                    Background="#2563EB"
                                    Foreground="White"/>
                            <Button Name="DeletePresetButton"
                                    Grid.Column="8"
                                    Content="Delete"
                                    Click="DeletePresetButton_Click"
                                    Padding="12,7"
                                    Height="32"
                                    VerticalAlignment="Center"
                                    BorderBrush="#CBD5E1"
                                    BorderThickness="1"
                                    Background="#EEF2F7"
                                    Foreground="#0F172A"/>
                        </Grid>

                        <ListBox Name="WorkflowPreviewListBox"
                                 Grid.Row="3"
                                 BorderBrush="#CBD5E1"
                                 BorderThickness="1"
                                 Background="White"
                                 DisplayMemberPath="Display"/>
                    </Grid>
                </Border>

                <GridSplitter Grid.Row="4"
                              Height="6"
                              HorizontalAlignment="Stretch"
                              VerticalAlignment="Center"
                              ResizeDirection="Rows"
                              ResizeBehavior="PreviousAndNext"
                              ShowsPreview="True"
                              Background="#D1D9E6"
                              Margin="0,0,0,6"/>

                <Border Grid.Row="5"
                        BorderBrush="#E2E8F0"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="10"
                        Background="#FBFDFF">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Name="StatusText"
                                       Text="Status: Idle"
                                       FontSize="13"
                                       Foreground="#1D4ED8"/>
                            <TextBlock Name="LastRunText"
                                       Grid.Column="1"
                                       Text="Last run: N/A"
                                       FontSize="13"
                                       Foreground="#64748B"/>
                        </Grid>

                        <TextBox Name="LogTextBox"
                                 Grid.Row="1"
                                 Margin="0,8,0,0"
                                 AcceptsReturn="True"
                                 VerticalScrollBarVisibility="Auto"
                                 HorizontalScrollBarVisibility="Auto"
                                 IsReadOnly="True"
                                 TextWrapping="Wrap"
                                 FontFamily="Consolas"
                                 FontSize="13"
                                 Padding="8"
                                 BorderBrush="#CBD5E1"
                                 BorderThickness="1"
                                 Background="#FFFFFF"
                                 Foreground="#0F172A"/>
                    </Grid>
                </Border>

                <TextBlock Grid.Row="6"
                           Text="Tip: Use Node Builder to define dependencies."
                           FontSize="11"
                           Foreground="#64748B"
                           HorizontalAlignment="Right"
                           Margin="0,8,0,0"/>
            </Grid>
        </Border>
    </Grid>
</Window>
